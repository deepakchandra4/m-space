<!DOCTYPE html>
<html lang="en" class="light scroll-smooth" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <title>
      M-Space - Real Estate
    </title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta
      name="description"
      content="Tailwind CSS Saas & Software Landing Page Template"
    />
    <meta
      name="keywords"
      content="agency, application, business, clean, creative, cryptocurrency, it solutions, modern, multipurpose, nft marketplace, portfolio, saas, software, tailwind css"
    />

    <meta name="version" content="2.3.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- favicon -->
    <link rel="shortcut icon" href="assets/imagess/favicon.ico" />

    <!-- Css -->
    <!-- Main Css -->
    <link href="assets/libs/simplebar/simplebar.min.css" rel="stylesheet" />
    <link
      href="assets/libs/%40mdi/font/css/materialdesignicons.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link rel="stylesheet" href="assets/css/tailwind.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body
    class="font-body text-base text-black dark:text-white dark:bg-slate-900"
  >
    <!-- Loader Start -->
    <!-- <div id="preloader">
            <div id="status">
                <div class="spinner">
                    <div class="double-bounce1"></div>
                    <div class="double-bounce2"></div>
                </div>
            </div>
        </div> -->
    <!-- Loader End -->

    <div class="page-wrapper toggled">
      <!-- sidebar-wrapper -->
      <nav id="sidebar" class="sidebar-wrapper sidebar-dark">
        <div class="sidebar-content">
            <div class="sidebar-brand">
                <a href="index.html"><img src="assets/imagess/logo-light.png" alt=""></a>
            </div>

            <ul class="sidebar-menu border-t border-white/10" data-simplebar="" style="height: calc(100% - 70px);">
                <li>
                    <a href="index.html"><i class="mdi mdi-chart-bell-curve-cumulative me-2"></i>Dashboard</a>
                </li>

                <li>
                    <a href="explore-property.html"><i class="mdi mdi-home-city me-2"></i>Explore Properties</a>
                </li>
                <li>
                    <a href="add-property.html"><i class="mdi mdi-home-plus me-2"></i>Add Properties</a>
                </li>
                <li>
                    <a href="property-list.html"><i class="mdi mdi-home-plus me-2"></i>Property List</a>
                </li>
            </ul>
            <!-- sidebar-menu  -->
        </div>
    </nav>
      <!-- sidebar-wrapper  -->

      <!-- Start Page Content -->
      <main class="page-content bg-gray-50 dark:bg-slate-800">
        <!-- Top Header -->
        <div class="top-header">
          <div class="header-bar flex justify-between">
              <div class="flex items-center space-x-1">
                  <!-- Logo -->
                  <a href="#" class="xl:hidden block me-2">
                      <img src="assets/imagess/logo-icon-32.png" class="md:hidden block" alt="">
                      <span class="md:block hidden">
                          <img src="assets/imagess/logo-dark.png" class="inline-block dark:hidden" alt="">
                          <img src="assets/imagess/logo-light.png" class="hidden dark:inline-block" alt="">
                      </span>
                  </a>
                  <!-- Logo -->

                  <!-- show or close sidebar -->
                  <a id="close-sidebar" class="size-8 inline-flex items-center justify-center tracking-wide align-middle duration-500 text-[20px] text-center bg-gray-50 dark:bg-slate-800 hover:bg-gray-100 dark:hover:bg-slate-700 border border-gray-100 dark:border-gray-800 text-slate-900 dark:text-white rounded-md" href="javascript:void(0)">
                      <i data-feather="menu" class="size-4"></i>
                  </a>
                  <!-- show or close sidebar -->
  
                  <!-- Searchbar -->
                  <div class="ps-1.5">
                      <div class="form-icon relative sm:block hidden">
                          <i class="mdi mdi-magnify absolute top-1/2 -translate-y-1/2 mt-[1px] start-3"></i>
                          <input type="text" class="form-input w-56 ps-9 py-2 px-3 h-8 bg-transparent dark:bg-slate-900 dark:text-slate-200 rounded-md outline-none border border-gray-100 dark:border-gray-800 focus:ring-0 bg-white" name="s" id="searchItem" placeholder="Search...">
                      </div>
                  </div>
                  <!-- Searchbar -->
              </div>

              <ul class="list-none mb-0 space-x-1">
                  <!-- User/Profile Dropdown -->
                  <li class="dropdown inline-block relative ">
                      <button data-dropdown-toggle="dropdown" class="dropdown-toggle items-center " type="button">
                          <span class="size-8 inline-flex items-center justify-center tracking-wide align-middle duration-500 text-[20px] text-center  border border-gray-100 dark:border-gray-800 text-slate-900 dark:text-white rounded-md"><img src="assets/imagess/client/07.jpg" class="rounded-md" alt=""></span>
                      </button>
                      <!-- Dropdown menu -->
                      <div class="dropdown-menu absolute end-0 m-0 mt-4 z-10 w-44 rounded-md overflow-hidden bg-white dark:bg-slate-900 shadow dark:shadow-gray-700 hidden" onclick="event.stopPropagation();">
                          <ul class="py-2 text-start">
                              <li>
                                  <a href="profile.html" class="block py-1 px-4 text-black"><i class="mdi mdi-account-outline me-2"></i>Profile</a>
                              </li>
                              </li>
                              <li>
                                  <a href="login.html" id="logout-btn" class="block py-1 px-4 text-black"><i class="mdi mdi-logout me-2"></i>Logout</a>
                              </li>
                          </ul>
                      </div>
                  </li><!--end dropdown-->
                  <!-- User/Profile Dropdown -->
              </ul>
          </div>
      </div>
        <!-- Top Header -->

        <div class="min-h-screen p-4">
          <!-- Table -->
          <div class="">
            <h1 class="text-2xl font-bold text-center mb-6">
              Real Estate Listings
            </h1>
            <div class="overflow-x-auto">
              <table
                class="min-w-full bg-white border-collapse border border-gray-300 rounded-lg shadow"
              >
                <thead>
                  <tr>
                    <th
                      class="py-3 px-4 bg-gray-100 border border-gray-300 text-left"
                    >
                      S.No
                    </th>
                    <th
                      class="py-3 px-4 bg-gray-100 border border-gray-300 text-left"
                    >
                      Location
                    </th>
                    <th
                      class="py-3 px-4 bg-gray-100 border border-gray-300 text-left"
                    >
                      Square Feet
                    </th>
                    <th
                      class="py-3 px-4 bg-gray-100 border border-gray-300 text-left"
                    >
                      Beds
                    </th>
                    <th
                      class="py-3 px-4 bg-gray-100 border border-gray-300 text-left"
                    >
                      Baths
                    </th>
                    <th
                      class="py-3 px-4 bg-gray-100 border border-gray-300 text-left"
                    >
                      Description
                    </th>
                    <th
                      class="py-3 px-4 bg-gray-100 border border-gray-300 text-left"
                    >
                      images
                    </th>
                    <th
                      class="py-3 px-4 bg-gray-100 border border-gray-300 text-left"
                    >
                      Price
                    </th>
                    <th
                      class="py-3 px-4 bg-gray-100 border border-gray-300 text-left"
                    >
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody id="table-body">
                  <!-- Rows will be dynamically inserted here -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Modal -->
          <div
            id="updateModal"
            class="inset-0 z-1 bg-opacity-25 flex items-center justify-center hidden"
          >
            <div class="bg-white rounded-lg shadow-lg p-6 w-1/2 h-fit">
              <h2 class="text-lg font-bold mb-4">Update Listing</h2>
              <form id="updateForm" onsubmit="saveChanges(event)">
                <div class="mb-4">
                  <label for="updateLocation" class="block text-sm font-medium"
                    >Location</label
                  >
                  <input
                    type="text"
                    id="updateLocation"
                    class="w-full border rounded px-3 py-2 mt-1"
                    required
                  />
                </div>
                <div class="mb-4">
                  <label
                    for="updateSquareFeet"
                    class="block text-sm font-medium"
                    >Square Feet</label
                  >
                  <input
                    type="text"
                    id="updateSquareFeet"
                    class="w-full border rounded px-3 py-2 mt-1"
                    required
                  />
                </div>
                <div class="mb-4">
                  <label for="updateBeds" class="block text-sm font-medium"
                    >Beds</label
                  >
                  <input
                    type="number"
                    id="updateBeds"
                    class="w-full border rounded px-3 py-2 mt-1"
                    required
                  />
                </div>
                <div class="mb-4">
                  <label for="updateBaths" class="block text-sm font-medium"
                    >Baths</label
                  >
                  <input
                    type="number"
                    id="updateBaths"
                    class="w-full border rounded px-3 py-2 mt-1"
                    required
                  />
                </div>
                <div class="mb-4">
                  <label
                    for="updateDescription"
                    class="block text-sm font-medium"
                    >Description</label
                  >
                  <textarea
                    id="updateDescription"
                    class="w-full border rounded px-3 py-2 mt-1"
                    required
                  ></textarea>
                </div>
                <div class="mb-4">
                  <label for="updateimages" class="block text-sm font-medium"
                    >images URL</label
                  >
                  <input
                    type="url"
                    id="updateimages"
                    class="w-full border rounded px-3 py-2 mt-1"
                    required
                  />
                </div>
                <div class="mb-4">
                  <label for="updatePrice" class="block text-sm font-medium"
                    >Price</label
                  >
                  <input
                    type="text"
                    id="updatePrice"
                    class="w-full border rounded px-3 py-2 mt-1"
                    required
                  />
                </div>
                <div class="flex justify-end space-x-4">
                  <button
                    type="button"
                    class="bg-gray-300 px-4 py-2 rounded"
                    onclick="closeModal()"
                  >
                    Cancel
                  </button>
                  <button
                    type="submit"
                    class="bg-blue-500 text-white px-4 py-2 rounded"
                  >
                    Save
                  </button>
                </div>
              </form>
            </div>
          </div>

          <script>
            let selectedRow = null;
            const propertyId = selectedRow ? selectedRow.getAttribute("data-id") : null;
            console.log("Selected row:", selectedRow);
          
            // Fetch data from API and display in the table
            async function fetchData() {
              try {
                const response = await fetch("http://localhost/m-space/backend/public/getProperty.php/");
                const data = await response.json();
          
                if (data && Array.isArray(data)) {
                  const tableBody = document.getElementById("table-body");
                  tableBody.innerHTML = ""; // Clear existing rows
          
                  data.forEach((property, index) => {
                    const row = document.createElement("tr");
                    row.setAttribute("data-id", property.ID);
                    row.classList.add(index % 2 === 0 ? "even:bg-gray-50" : "odd:bg-gray-100");
          
                    // Construct the full image URL
                    const imageUrl = `http://localhost/m-space/backend/public/${property.images}` ;
          
                    row.innerHTML = `
                      <td class="py-3 px-4 border border-gray-300">${index + 1}</td>
                      <td class="py-3 px-4 border border-gray-300">${property.location}</td>
                      <td class="py-3 px-4 border border-gray-300">${property.squarefeet}</td>
                      <td class="py-3 px-4 border border-gray-300">${property.beds}</td>
                      <td class="py-3 px-4 border border-gray-300">${property.baths}</td>
                      <td class="py-3 px-4 border border-gray-300">${property.description}</td>
                      <td class="py-1 px-1 border border-gray-300">
                        <img src="${imageUrl}" alt="Property images" class="rounded shadow h-20 w-20">
                      </td>
                      <td class="py-3 px-4 border border-gray-300">${property.price}</td>
                      <td class="py-3 px-4 border border-gray-300">
                        <button class="text-blue-600 hover:underline mr-2" onclick="openModal(this)">Update</button>
                        <button class="text-red-600 hover:underline" onclick="deleteRow(this)">Delete</button>
                      </td>
                    `;
                    tableBody.appendChild(row);
                  });
                }
              } catch (error) {
                console.error("Error fetching data:", error);
              }
            }
          
            // Open the update modal
            function openModal(button) {
              selectedRow = button.closest("tr");
              console.log("Button clicked:", button); // Log button to ensure it's the correct button
              const cells = selectedRow.children;
          
              document.getElementById("updateLocation").value = cells[1].innerText;
              document.getElementById("updateSquareFeet").value = cells[2].innerText;
              document.getElementById("updateBeds").value = cells[3].innerText;
              document.getElementById("updateBaths").value = cells[4].innerText;
              document.getElementById("updateDescription").value = cells[5].innerText;
              document.getElementById("updateimages").value = cells[6].querySelector("img").src;
              document.getElementById("updatePrice").value = cells[7].innerText;
          
              document.getElementById("updateModal").classList.remove("hidden");
            }
          
            function closeModal() {
              document.getElementById("updateModal").classList.add("hidden");
              document.getElementById("updateForm").reset(); // Reset form fields after closing modal
            }
          
            function saveChanges(event) {
              event.preventDefault();
          
              const propertyId = selectedRow.getAttribute("data-id");
              const updatedData = {
                location: document.getElementById("updateLocation").value,
                square_feet: document.getElementById("updateSquareFeet").value,
                beds: document.getElementById("updateBeds").value,
                baths: document.getElementById("updateBaths").value,
                description: document.getElementById("updateDescription").value,
                images: document.getElementById("updateimages").value,
                price: document.getElementById("updatePrice").value,
              };
          
              // Update the property via the PHP API
              fetch(`http://localhost/m-space/backend/public/updateProperty.php?id=${propertyId}`, {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(updatedData),
              })
                .then((response) => response.json())
                .then((data) => {
                  if (data.success) {
                    const cells = selectedRow.children;
                    cells[1].innerText = updatedData.location;
                    cells[2].innerText = updatedData.square_feet;
                    cells[3].innerText = updatedData.beds;
                    cells[4].innerText = updatedData.baths;
                    cells[5].innerText = updatedData.description;
                    cells[6].querySelector("img").src = updatedData.images;
                    cells[7].innerText = updatedData.price;
          
                    closeModal();
                  } else {
                    alert("Failed to update the property.");
                  }
                })
                .catch((error) => {
                  console.error("Error updating property:", error);
                });
            }
          
            // Delete a property
            function deleteRow(button) {
              const propertyId = button.closest("tr").getAttribute("data-id");
          
              if (!propertyId) {
                console.error("Property ID not found.");
                return;
              }
          
              if (confirm("Are you sure you want to delete this property?")) {
                fetch(`http://localhost/m-space/backend/public/deleteProperty.php?id=${propertyId}`, {
                  method: "DELETE",
                  headers: {
                    "Content-Type": "application/json",
                  },
                })
                  .then((response) => response.json())
                  .then((data) => {
                    if (data.status === "success") {
                      button.closest("tr").remove(); // Remove the row from UI on success
                    } else {
                      alert("Failed to delete the property.");
                    }
                  })
                  .catch((error) => {
                    console.error("Error deleting property:", error);
                  });
              }
            }
          
            // Initialize the page by fetching the data
            fetchData();
          </script>
          
          
        </div>

        <!-- Footer Start -->
        <footer
          class="shadow dark:shadow-gray-700 bg-white dark:bg-slate-900 px-6 py-4"
        >
          <div class="container-fluid">
            <div class="grid grid-cols-1">
              <div class="sm:text-start text-center mx-md-2"></div>
              <!--end col-->
            </div>
            <!--end grid-->
          </div>
          <!--end container-->
        </footer>
        <!--end footer-->
        <!-- End -->
      </main>
      <!--End page-content" -->
    </div>
    <!-- page-wrapper -->

    <!-- JAVASCRIPTS -->
    <script>
      // Check if the admin is logged in
      if (!localStorage.getItem("adminLoggedIn")) {
          // If not logged in, redirect to login page
          window.location.href = "login.html";
      }

      // Handle logout
      document.getElementById("logout-btn").addEventListener("click", function() {
          localStorage.removeItem("adminLoggedIn");
          localStorage.removeItem("adminUsername");
          window.location.href = "login.html";
      });
  </script>
    <script src="assets/libs/feather-icons/feather.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/js/plugins.init.js"></script>
    <script src="assets/js/app.js"></script>
    <!-- JAVASCRIPTS -->
  </body>
</html>
